{
  "version": 3,
  "sources": ["../../../../../../../node_modules/wawa-lipsync/dist/wawa-lipsync.es.js"],
  "sourcesContent": ["var x = Object.defineProperty;\nvar F = (i, t, s) => t in i ? x(i, t, { enumerable: !0, configurable: !0, writable: !0, value: s }) : i[t] = s;\nvar c = (i, t, s) => F(i, typeof t != \"symbol\" ? t + \"\" : t, s);\nfunction _(i) {\n  return i.length ? i.reduce((t, s) => t + s, 0) / i.length : 0;\n}\nvar e = /* @__PURE__ */ ((i) => (i.sil = \"viseme_sil\", i.PP = \"viseme_PP\", i.FF = \"viseme_FF\", i.TH = \"viseme_TH\", i.DD = \"viseme_DD\", i.kk = \"viseme_kk\", i.CH = \"viseme_CH\", i.SS = \"viseme_SS\", i.nn = \"viseme_nn\", i.RR = \"viseme_RR\", i.aa = \"viseme_aa\", i.E = \"viseme_E\", i.I = \"viseme_I\", i.O = \"viseme_O\", i.U = \"viseme_U\", i))(e || {});\nconst A = {\n  [e.sil]: \"silence\",\n  [e.PP]: \"plosive\",\n  [e.FF]: \"fricative\",\n  [e.TH]: \"fricative\",\n  [e.DD]: \"plosive\",\n  [e.kk]: \"plosive\",\n  [e.CH]: \"fricative\",\n  [e.SS]: \"fricative\",\n  [e.nn]: \"plosive\",\n  [e.RR]: \"fricative\",\n  [e.aa]: \"vowel\",\n  [e.E]: \"vowel\",\n  [e.I]: \"vowel\",\n  [e.O]: \"vowel\",\n  [e.U]: \"vowel\"\n  /* vowel */\n};\nclass R {\n  constructor(t = {\n    fftSize: 2048,\n    historySize: 10\n  }) {\n    c(this, \"features\", null);\n    c(this, \"viseme\", e.sil);\n    c(this, \"audioContext\");\n    c(this, \"analyser\");\n    c(this, \"dataArray\");\n    c(this, \"history\");\n    c(this, \"historySize\");\n    c(this, \"sampleRate\");\n    c(this, \"binWidth\");\n    c(this, \"bands\");\n    c(this, \"audioSource\");\n    c(this, \"state\", \"silence\");\n    const { fftSize: s = 2048, historySize: o = 10 } = t;\n    this.audioContext = new (window.AudioContext || window.webkitAudioContext)(), this.analyser = this.audioContext.createAnalyser(), this.analyser.fftSize = s, this.dataArray = new Uint8Array(this.analyser.frequencyBinCount), this.history = [], this.historySize = o, this.sampleRate = this.audioContext.sampleRate, this.binWidth = this.sampleRate / s, this.bands = [\n      { start: 50, end: 200 },\n      // Band 1: Low energy\n      { start: 200, end: 400 },\n      // Band 2: F1 lower\n      { start: 400, end: 800 },\n      // Band 3: F1 mid\n      { start: 800, end: 1500 },\n      // Band 4: F2 front\n      { start: 1500, end: 2500 },\n      // Band 5: F2/F3\n      { start: 2500, end: 4e3 },\n      // Band 6: Fricatives\n      { start: 4e3, end: 8e3 }\n      // Band 7: High fricatives\n    ];\n  }\n  connectAudio(t) {\n    if (this.audioContext.resume(), this.history = [], this.features = null, this.state = \"silence\", this.audioSource === t)\n      return;\n    if (this.audioSource = t, !t.src) {\n      console.warn(\"An audio source must be set before connecting\");\n      return;\n    }\n    this.audioContext.createMediaElementSource(t).connect(this.analyser), this.analyser.connect(this.audioContext.destination);\n  }\n  // Connect live microphone\n  async connectMicrophone() {\n    try {\n      const t = await navigator.mediaDevices.getUserMedia({ audio: !0 }), s = this.audioContext.createMediaStreamSource(t);\n      return s.connect(this.analyser), this.analyser.connect(this.audioContext.destination), s;\n    } catch (t) {\n      throw console.error(\"Error accessing microphone:\", t), t;\n    }\n  }\n  extractFeatures() {\n    this.analyser.getByteFrequencyData(this.dataArray);\n    const t = this.bands.map(({ start: r, end: u }) => {\n      const d = Math.round(r / this.binWidth), b = Math.min(\n        Math.round(u / this.binWidth),\n        this.dataArray.length - 1\n      );\n      return _(Array.from(this.dataArray.slice(d, b))) / 255;\n    });\n    let s = 0, o = 0;\n    for (let r = 0; r < this.dataArray.length; r++) {\n      const u = r * this.binWidth, d = this.dataArray[r] / 255;\n      s += d, o += u * d;\n    }\n    const a = s > 0 ? o / s : 0, n = _(t), l = t.map((r, u) => {\n      if (this.history.length < 2) return 0;\n      const d = this.history[this.history.length - 2].bands[u];\n      return r - d;\n    }), v = {\n      bands: t,\n      deltaBands: l,\n      volume: n,\n      centroid: a\n    };\n    return s > 0 && (this.history.push(v), this.history.length > this.historySize && this.history.shift()), v;\n  }\n  getAveragedFeatures() {\n    const t = this.history.length, s = {\n      volume: 0,\n      centroid: 0,\n      bands: Array(this.bands.length).fill(0)\n    };\n    for (const a of this.history)\n      s.volume += a.volume, s.centroid += a.centroid, a.bands.forEach((n, l) => s.bands[l] += n);\n    const o = s.bands.map((a) => a / t);\n    return {\n      volume: s.volume / t,\n      centroid: s.centroid / t,\n      bands: o,\n      deltaBands: o\n    };\n  }\n  detectState() {\n    const t = this.history[this.history.length - 1];\n    if (!t) {\n      this.state = \"silence\", this.viseme = e.sil;\n      return;\n    }\n    const s = this.getAveragedFeatures(), o = t.volume - s.volume, a = t.centroid - s.centroid, n = this.computeVisemeScores(\n      t,\n      s,\n      o,\n      a\n    ), l = this.adjustScoresForConsistency(n);\n    let v = -1 / 0, r = e.sil;\n    for (const d in l)\n      l[d] > v && (v = l[d], r = d);\n    let u = A[r];\n    this.state = u, this.viseme = r;\n  }\n  // Compute scores for each viseme\n  computeVisemeScores(t, s, o, a) {\n    const n = {\n      [e.sil]: 0,\n      [e.PP]: 0,\n      [e.FF]: 0,\n      [e.TH]: 0,\n      [e.DD]: 0,\n      [e.kk]: 0,\n      [e.CH]: 0,\n      [e.SS]: 0,\n      [e.nn]: 0,\n      [e.RR]: 0,\n      [e.aa]: 0,\n      [e.E]: 0,\n      [e.I]: 0,\n      [e.O]: 0,\n      [e.U]: 0\n    }, [l, v, r, u, d, b, C] = t.bands;\n    if (s.volume < 0.2 && t.volume < 0.2 && (n[e.sil] = 1), Object.entries(A).forEach(([y, m]) => {\n      m === \"plosive\" && (o < 0.01 && (n[y] -= 0.5), s.volume < 0.2 && (n[y] += 0.2), a > 1e3 && (n[y] += 0.2));\n    }), t.centroid > 1e3 && t.centroid < 8e3 && (t.centroid > 7e3 ? n[e.DD] += 0.6 : t.centroid > 5e3 ? n[e.kk] += 0.6 : t.centroid > 4e3 ? (n[e.PP] += 1, C > 0.25 && t.centroid < 6e3 && (n[e.DD] += 1.4)) : n[e.nn] += 0.6), a > 1e3 && t.centroid > 6e3 && s.centroid > 5e3 && t.bands[6] > 0.4 && s.bands[6] > 0.3 && (n[e.FF] = 0.7), s.volume > 0.1 && s.centroid < 6e3 && t.centroid < 6e3) {\n      const [y, m, h, f, p] = s.bands, g = Math.abs(y - m), w = Math.max(\n        Math.abs(m - h),\n        Math.abs(m - f),\n        Math.abs(h - f)\n      );\n      (h > 0.1 || f > 0.1) && (f > h && (n[e.aa] = 0.8, h > m && (n[e.aa] += 0.2)), h > m && h > f && (n[e.I] = 0.7), g < 0.25 && (n[e.U] = 0.7), w < 0.25 && (n[e.O] = 0.9), m > h && h > f && (n[e.E] = 1), h < 0.2 && f > 0.3 && (n[e.I] = 0.7), h > 0.25 && p > 0.25 && (n[e.O] = 0.7), h < 0.15 && p < 0.15 && (n[e.U] = 0.7));\n    }\n    return n;\n  }\n  // Adjust scores based on current state and viseme for consistency\n  adjustScoresForConsistency(t) {\n    const s = { ...t };\n    if (this.viseme && this.state)\n      for (const o in s)\n        o === this.viseme && (s[o] *= 1.3);\n    return s;\n  }\n  processAudio() {\n    this.features = this.extractFeatures(), this.detectState();\n  }\n}\nexport {\n  R as Lipsync,\n  e as VISEMES\n};\n"],
  "mappings": "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",
  "names": []
}
